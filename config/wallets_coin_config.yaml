# Variables used to clean and filter raw data before training data is built
data_cleaning:

    # Market data filters
    max_initial_market_cap: 999150_000_000  # coins above this market cap as of the start of the training period will be removed from all datasets
    max_gap_days: 50  # Maximum consecutive missing days to fill in price gaps (e.g., price interpolation for gaps up to 2 days)
    min_daily_volume: 500 # Minimum average daily volume the coin must have


# Variables used for comnverting the wallet scores into coin forecasts
coin_validation_analysis:

    # Forecasting methods
    top_n: 5  # how many of the top coins of a given sort method will be included in performance assessments
    sort_method: "top_wallet_balance_pct"  # which coin wallet metric to use for coin forecast rankings

# Which wallet features to load
wallet_features:

    # Metadata for which scores to load
    wallet_scores_path: "temp/wallet_modeling_score_dfs"
    wallet_scores: [
        'net_gain_ntile_250101',
        'net_gain_winsorized_250101',
        'net_gain_raw_250101'
    ]

    # Wallets with volume/balances below this won't be counted in medians/distributions/etc
    usd_materiality: 20

    # Metrics to drop based on low obsserved importance
    drop_trading_metrics: [
        'average_transaction'
    ]


# How to segment wallet features
wallet_segmentation:
    # score_segment_quantiles: [0.1, 0.3, 0.5, 0.7, 0.9]  # higher is better; how to assign wallet a score segment
    score_segment_quantiles: [0.05, 0.15, 0.5, 0.85, 0.95]  # higher is better; how to assign wallet a score segment
    training_period_cluster_groups: [2, 4]  # which n clusters assignment from the training period to segment by

# Variables used in the generation of the validation period coin model
coin_modeling:

    # Thresholds for coin inclusion in training data
    min_cohort_wallets: 25  # how many wallets must hold a coin for the coin to be elegible for forecasting
    min_cohort_balance: 20000  # how much USD all wallets must hold for the coin to be elegible for forecasting

    # Params used to remove unnecessary features
    feature_selection:
        variance_threshold: 0.02
        correlation_threshold: 0.95

    # Thresholds for coin inclusion in training data
    min_market_cap: 00_000  # coins below this market cap will not be included in performance assessments
    max_market_cap: 999350_000_000  # coins above this market cap will not be included in performance assessments

    # Target variable parameters
    target_variable: "coin_return_winsorized"
    # target_variable: "coin_return_pctile_full"
    # target_variable: "coin_return_pctile"

    returns_winsorization: 0.02
    drop_columns: []


    # Model specifics
    model_type: "xgb"
    model_params:
        n_estimators: 200
        max_depth: 5
        learning_rate: 0.05
        subsample: 0.8
        colsample_bytree: 1.0
        min_child_weight: 5
        # early_stopping_rounds: 20
        # eval_metric: 'rmse'

        # non modeling metaparams
        verbose: 50
        random_state: 42
        n_jobs: -1

    # Parameter tuning
    grid_search_params:

        # Search methodology
        enabled: false # whether to grid search
        n_iter: 10  # random search limit
        scoring: 'neg_root_mean_squared_error'
        n_splits: 3  # cv splits
        n_jobs: -1
        verbose_level: 3  # scikit-learn verbosity

        # Params
        param_grid:
            regressor__n_estimators: [500]
            regressor__max_depth: [3, 5, 7]
            regressor__learning_rate: [0.05, 0.1, 0.15]
