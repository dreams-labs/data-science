# data-science/wallet_features

This is the primary feature engineering module for the wallet_modeling/wallet_model.py. These are wallet-level feature engineering modules that transform transaction and market data into predictive features. These feature modules all intake a wallet time series df, and output features flattened to a single row per wallet that can be fed into a model that attempts to predict wallet-level performance.

Note that coin-level features are appended to the hybridized wallet-coin pairs. These coin-level features are generated by the coin_features directory as they do not output features keyed on the wallet level..

## Key Modules

**wallet_features_orchestrator.py**
- `WalletFeaturesOrchestrator` class - Coordinates feature generation across all modules with consistent wallet_address indexing
- Handles hybridization/dehybridization cycles for wallet-coin pair modeling and appending of coin-level features
- Manages concurrent feature processing across multiple time windows
- Ensures complete wallet coverage through appropriate joining and fill strategies

**Feature Generation Modules**
- `trading_features.py` - `calculate_wallet_trading_features()` for comprehensive trading metrics, time-weighted returns, and cost basis tracking
- `performance_features.py` - `calculate_performance_features()` for profit/loss ratios, return calculations, and winsorized performance transformations
- `market_cap_features.py` - `calculate_market_cap_features()` for volume/balance-weighted market cap analysis and portfolio distribution statistics
- `transfers_features.py` - `calculate_transfers_features()` and `retrieve_transfers_sequencing()` for early adoption timing and buyer sequence rankings
- `market_timing_features.py` - `calculate_market_timing_features()` for transaction timing alignment with future market movements and technical indicators
- `scenario_features.py` - `calculate_scenario_features()` for ideal vs worst case timing performance with BigQuery price range analysis
- `balance_features.py` - `calculate_balance_features()` for portfolio concentration metrics and distribution features
- `clustering_features.py` - `create_kmeans_cluster_features()` for PCA-based wallet segmentation and distance calculations
- `time_series_features.py` - `calculate_macro_features()` and `calculate_market_data_features()` for macroeconomic and market indicator aggregation

## Integration

Orchestrated by `wallet_modeling.WalletTrainingDataOrchestrator` and `wallet_modeling.WalletEpochsOrchestrator`. Uses `base_modeling.feature_selection` utilities and integrates with `coin_features` for hybrid wallet-coin modeling workflows.

## Usage

Primary entry point is `WalletFeaturesOrchestrator.calculate_wallet_features()` which returns a complete feature matrix indexed by wallet_address. Individual feature modules can be called directly but require consistent data preparation and validation.